@page
@model DynamicFormsRazor.Pages.Forms.IndexModel
@{
    ViewData["Title"] = "Current Form Definitions";
}

<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-semibold mb-0 text-primary">
            <i class="bi bi-journal-text me-2"></i>Current Form Definitions
        </h2>
        <div class="d-flex gap-2">
            <form method="post" asp-page-handler="NewWallet">
                <button class="btn btn-outline-dark" type="submit">
                    <i class="bi bi-wallet2 me-1"></i>Create Wallets
                </button>
            </form>
            <a href="/Forms/Create" class="btn btn-primary">
                <i class="bi bi-plus-circle me-1"></i>New Definition
            </a>
        </div>
    </div>

    <!-- ✅ Alert messages -->
    @if (!string.IsNullOrWhiteSpace(Model.Message))
    {
        <div class="alert alert-success shadow-sm border-start border-4 border-success mb-4">
            <i class="bi bi-check-circle-fill me-2"></i>@Model.Message
        </div>
    }

    @if (!string.IsNullOrWhiteSpace(Model.Error))
    {
        <div class="alert alert-danger shadow-sm border-start border-4 border-danger mb-4">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>@Model.Error
        </div>
    }

    <!-- ✅ Wallet & token summary -->
    @if (!string.IsNullOrWhiteSpace(Model.Sender))
    {
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-body small">
                <h6 class="fw-bold mb-2 text-primary"><i class="bi bi-link-45deg me-1"></i>Blockchain Context</h6>
                <div class="row">
                    <div class="col-md-4">
                        <strong>Sender:</strong><br /><code>@Model.Sender</code>
                    </div>
                    <div class="col-md-4">
                        <strong>Receiver:</strong><br /><code>@Model.Receiver</code>
                    </div>
                    <div class="col-md-4">
                        <strong>TokenId:</strong><br /><code>@Model.TokenId</code>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- ✅ Form definitions -->
    @if (!Model.Items.Any())
    {
        <div class="alert alert-info text-center shadow-sm py-4">
            <i class="bi bi-info-circle me-2"></i>No form definitions yet — create one to get started!
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 g-3">
            @foreach (var d in Model.Items)
            {
                <div class="col">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                                <div class="d-flex justify-content-between align-items-start flex-wrap">
                                    <div>
                                        <h5 class="card-title mb-1 text-dark">@d.Name</h5>
                                        <p class="text-muted small mb-2">
                                            <strong>Key:</strong> <code>@d.FormKey</code> •
                                            <strong>Version:</strong> v@d.Version <br />
                                            <strong>Created:</strong> @d.CreatedAtUtc.ToLocalTime()
                                        </p>
                                        <div class="d-flex flex-wrap gap-2">
                                            <span class="badge bg-secondary">@d.Sections.Count section(s)</span>
                                            <span class="badge bg-success">Current</span>
                                        </div>
                                    </div>
                                    <a href="/Forms/Render?id=@d.Id"
                                       class="btn btn-sm btn-outline-primary align-self-start">
                                        <i class="bi bi-box-arrow-up-right"></i>
                                    </a>
                                </div>
                            </div>

                            <hr class="my-3" />

                            <div class="d-flex flex-wrap gap-2">
                                <a class="btn btn-sm btn-outline-secondary" href="/Forms/History?key=@d.FormKey">
                                    <i class="bi bi-clock-history me-1"></i>History
                                </a>
                                <a class="btn btn-sm btn-outline-dark" href="/Forms/Submissions?key=@d.FormKey">
                                    <i class="bi bi-list-ul me-1"></i>Submissions
                                </a>
                                <a class="btn btn-sm btn-success" href="/Forms/Create?fromKey=@d.FormKey">
                                    <i class="bi bi-file-earmark-plus me-1"></i>New Version
                                </a>
                            </div>

                            <div class="mt-3 p-2 bg-light rounded-3 border d-flex flex-column gap-2">
                                <form method="post" asp-page-handler="CreateToken" class="d-inline">
                                    <input type="hidden" name="id" value="@d.Id" />
                                    <button class="btn btn-sm btn-outline-success w-100" type="submit">
                                        <i class="bi bi-currency-bitcoin me-1"></i>Create Token
                                    </button>
                                </form>

                                <div class="d-flex flex-wrap gap-2">
                                    <form method="post" asp-page-handler="Mint" class="flex-fill">
                                        <input type="hidden" name="id" value="@d.Id" />
                                        <div class="input-group input-group-sm">
                                            <input type="number" name="amount" value="1" class="form-control" />
                                            <button class="btn btn-outline-primary" type="submit">
                                                <i class="bi bi-coin me-1"></i>Mint
                                            </button>
                                        </div>
                                    </form>

                                    <form method="post" asp-page-handler="Transfer" class="flex-fill">
                                        <input type="hidden" name="id" value="@d.Id" />
                                        <div class="input-group input-group-sm">
                                            <input type="number" name="amount" value="1" class="form-control" />
                                            <button class="btn btn-outline-warning" type="submit">
                                                <i class="bi bi-arrow-left-right me-1"></i>Transfer
                                            </button>
                                        </div>
                                    </form>

                                    <form method="post" asp-page-handler="Burn" class="flex-fill">
                                        <input type="hidden" name="id" value="@d.Id" />
                                        <div class="input-group input-group-sm">
                                            <input type="number" name="amount" value="1" class="form-control" />
                                            <button class="btn btn-outline-danger" type="submit">
                                                <i class="bi bi-fire me-1"></i>Burn
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
